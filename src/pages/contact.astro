---
import BaseLayout from '../layouts/BaseLayout.astro';
import settings from '../content/pages/settings.json';

// EmailJS 설정
const emailjsPublicKey = 'qZJl-FQP1CJJqGvNp';
const emailjsServiceId = 'service_8527rq8';
const emailjsTemplateId = 'template_e1z7fdh';
---

<BaseLayout 
    title="문의하기"
    description="브리츠메디 제품 문의, 데모 요청, 파트너십 제안을 환영합니다. 경기도 성남시 본사로 연락 주시거나 온라인 문의 양식을 이용해 주세요. 전화 070-4348-7244, 이메일 marketing@britzmedi.co.kr"
    canonicalPath="/contact"
>
    <section class="page-hero">
        <div class="page-hero-bg"></div>
        <div class="page-hero-overlay"></div>
        <div class="page-hero-content">
            <p class="page-hero-label">Contact Us</p>
            <h1 class="page-hero-title"><em>문의</em>하기</h1>
        </div>
    </section>

    <section class="bg-dark" style="padding: 5rem 4rem;">
        <div class="container">
            <div class="contact-wrapper">
                <div class="contact-info reveal">
                    <h2>연락처 <em>정보</em></h2>
                    <div class="info-list">
                        <div class="info-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                <circle cx="12" cy="10" r="3"/>
                            </svg>
                            <div>
                                <h4>주소</h4>
                                <p>{settings.company.address}</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                            </svg>
                            <div>
                                <h4>전화</h4>
                                <p>{settings.company.phone}</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                <polyline points="22,6 12,13 2,6"/>
                            </svg>
                            <div>
                                <h4>이메일</h4>
                                <p>{settings.company.email}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="contact-form-wrapper reveal">
                    <div class="form-tabs">
                        <button class="form-tab active" data-tab="inquiry">상담신청</button>
                        <button class="form-tab" data-tab="partnership">제휴문의</button>
                    </div>

                    <form id="contactForm" class="contact-form">
                        <input type="hidden" name="form_type" id="formType" value="상담신청" />
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="name">이름 *</label>
                                <input type="text" id="name" name="name" required />
                            </div>
                            <div class="form-group">
                                <label for="company">회사/병원명</label>
                                <input type="text" id="company" name="company" />
                            </div>
                            <div class="form-group">
                                <label for="phone">연락처 *</label>
                                <input type="tel" id="phone" name="phone" required />
                            </div>
                            <div class="form-group">
                                <label for="email">이메일 *</label>
                                <input type="email" id="email" name="email" required />
                            </div>
                            <div class="form-group full-width" id="productGroup">
                                <label for="product">관심 제품</label>
                                <select id="product" name="product">
                                    <option value="">선택해주세요</option>
                                    <option value="TORR RF">TORR RF</option>
                                    <option value="UL BLANC">UL BLANC</option>
                                    <option value="NEWCHAE">NEWCHAE</option>
                                    <option value="기타">기타</option>
                                </select>
                            </div>
                            <div class="form-group full-width" id="partnershipGroup" style="display: none;">
                                <label for="partnershipType">제휴 유형</label>
                                <select id="partnershipType" name="partnership_type">
                                    <option value="">선택해주세요</option>
                                    <option value="판매 대리점">판매 대리점</option>
                                    <option value="병원/클리닉">병원/클리닉</option>
                                    <option value="연구 협력">연구 협력</option>
                                    <option value="기타">기타</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label for="message">문의 내용 *</label>
                                <textarea id="message" name="message" rows="5" required></textarea>
                            </div>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="privacy" name="privacy" required />
                            <label for="privacy">개인정보 수집 및 이용에 동의합니다. *</label>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            문의 보내기
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>
</BaseLayout>

<style>
    .contact-wrapper {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 4rem;
    }
    .contact-info h2 {
        font-family: var(--font-main);
        font-size: 1.75rem;
        font-weight: 300;
        margin-bottom: 2rem;
    }
    .info-list {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }
    .info-item {
        display: flex;
        gap: 1rem;
    }
    .info-item svg {
        width: 24px;
        height: 24px;
        color: var(--gold);
        flex-shrink: 0;
        margin-top: 0.25rem;
    }
    .info-item h4 {
        font-size: 0.9rem;
        font-weight: 500;
        margin-bottom: 0.25rem;
    }
    .info-item p {
        font-size: 0.9rem;
        color: var(--gray-400);
    }
    .form-tabs {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
    }
    .form-tab {
        padding: 0.75rem 1.5rem;
        background: none;
        border: 1px solid var(--gray-700);
        color: var(--gray-400);
        font-family: inherit;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .form-tab.active {
        border-color: var(--gold);
        color: var(--gold);
    }
    .form-tab:hover {
        border-color: var(--gold);
    }
    .contact-form .btn {
        margin-top: 1.5rem;
    }
    @media (max-width: 1024px) {
        .contact-wrapper {
            grid-template-columns: 1fr;
            gap: 3rem;
        }
    }
</style>

<script define:vars={{ emailjsPublicKey, emailjsServiceId, emailjsTemplateId }}>
    // Tab switching
    const tabs = document.querySelectorAll('.form-tab');
    const productGroup = document.getElementById('productGroup');
    const partnershipGroup = document.getElementById('partnershipGroup');
    const formTypeInput = document.getElementById('formType');

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            const tabType = tab.dataset.tab;
            if (tabType === 'inquiry') {
                productGroup.style.display = 'block';
                partnershipGroup.style.display = 'none';
                formTypeInput.value = '상담신청';
            } else {
                productGroup.style.display = 'none';
                partnershipGroup.style.display = 'block';
                formTypeInput.value = '제휴문의';
            }
        });
    });

    // Form submission with EmailJS
    const form = document.getElementById('contactForm');
    
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalHTML = submitBtn.innerHTML;
        submitBtn.innerHTML = '<span style="display:inline-block;width:16px;height:16px;border:2px solid rgba(0,0,0,0.3);border-radius:50%;border-top-color:#000;animation:spin 0.8s linear infinite;margin-right:8px;"></span> 전송 중...';
        submitBtn.disabled = true;

        // Add spin animation
        if (!document.getElementById('spin-style')) {
            const style = document.createElement('style');
            style.id = 'spin-style';
            style.textContent = '@keyframes spin { to { transform: rotate(360deg); } }';
            document.head.appendChild(style);
        }

        try {
            // Load EmailJS SDK
            if (!window.emailjs) {
                await new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js';
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
                emailjs.init(emailjsPublicKey);
            }

            const formData = new FormData(form);
            const templateParams = {
                form_type: formData.get('form_type'),
                name: formData.get('name'),
                company: formData.get('company') || '-',
                phone: formData.get('phone'),
                email: formData.get('email'),
                product: formData.get('product') || formData.get('partnership_type') || '-',
                message: formData.get('message'),
            };

            await emailjs.send(emailjsServiceId, emailjsTemplateId, templateParams);
            
            alert('문의가 성공적으로 접수되었습니다. 빠른 시일 내에 연락드리겠습니다.');
            form.reset();
        } catch (error) {
            console.error('EmailJS Error:', error);
            alert('전송에 실패했습니다. 잠시 후 다시 시도해주세요.');
        } finally {
            submitBtn.innerHTML = originalHTML;
            submitBtn.disabled = false;
        }
    });
</script>
